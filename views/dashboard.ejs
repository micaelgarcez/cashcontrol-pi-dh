<%- include('./parts/head',{title:'CASH Control'}); %>
<main>
    <div>
        <br>
    </div>
    <section class="container">
        <div id="Saldos">
			<div class="item head">
				<div class="datas">
                    <div class="name"><p>Saldo em Contas</p></div>
                    <div class="name"><p> <%= (resumo[0].credito - resumo[0].debito).toLocaleString('pt-br', { minimumFractionDigits: 2 , style: 'currency', currency: 'BRL' }) %> </p></div>
                </div>
                <div class="datas">
                    <div class="name"><p>Receitas</p></div>
                    <div class="name"><p> <%= (Number(resumo[0].credito)).toLocaleString('pt-br', { minimumFractionDigits: 2 , style: 'currency', currency: 'BRL' }) %> </p></div>
                </div>
            </div>
            <div class="item">
                <div class="datas">
                    <div class="name"><p>Despesas</p></div>
                    <div class="name"><p> <%= (Number(resumo[0].despesas)).toLocaleString('pt-br', { minimumFractionDigits: 2 , style: 'currency', currency: 'BRL' }) %> </p></div>
                </div>
                <div class="datas">
                    <div class="name"><p>Cartões</p></div>
                    <div class="name"><p> <%= (Number(resumo[0].cartao)).toLocaleString('pt-br', { minimumFractionDigits: 2 , style: 'currency', currency: 'BRL' }) %> </p></div>
                </div>
            </div>
        </div>  
    </section>

    <div style="display: flex;">
        <div id="chart_div" style="width: 550px; height: 400px; float:left;"></div>
        <br>
        <div id="chart_div2" style="width: 550px; height: 400px; float:right;"></div>
    </div>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

        google.charts.load('current', {'packages':['corechart', 'bar']});
        google.charts.setOnLoadCallback(drawStuff);

        let resultado = <%- JSON.stringify(resultado)%>;
        let a = [];
        a.push([ 'Categoria', 'Previsto', 'Gasto' ]);
        resultado.forEach(x => {
            a.push([ x.CATEGORIA, Number(x.PREVISTO), Number(x.GASTO) ]);
        });

        function drawStuff() {

            var button = document.getElementById('change-chart');
            var chartDiv = document.getElementById('chart_div');

            var data = google.visualization.arrayToDataTable(a);

            var materialOptions = {
                width: 550,
                height: 400,
                chart: {
                title: 'Gasto Previsto X Realizado',
                subtitle: 'Valor Previsto versus Gasto por Categoria para o mês atual'
                },
                series: {
                0: { axis: 'Previsto' }, // Bind series 0 to an axis named 'distance'.
                1: { axis: 'Gasto' } // Bind series 1 to an axis named 'brightness'.
                },
                axes: {
                y: {
                    distance: {label: 'parsecs'}, // Left y-axis.
                    brightness: {side: 'right', label: 'apparent magnitude'} // Right y-axis.
                }
                }
            };

            var classicOptions = {
                width: 550,
                height: 400,
                series: {
                0: {targetAxisIndex: 0},
                //1: {targetAxisIndex: 1}
                },
                title: 'Previsto X Gasto',
                /*
                vAxes: {
                // Adds titles to each axis.
                0: {title: 'parsecs'},
                1: {title: 'apparent magnitude'}
                }
                */
            };

            function drawClassicChart() {
                var classicChart = new google.visualization.ColumnChart(chartDiv);
                classicChart.draw(data, classicOptions);
            }

            drawClassicChart();

            //GRÁFICO 2

            let b = [];
            b.push([ 'Categoria', 'Gasto' ]);
            resultado.forEach(x => {
                b.push([ x.CATEGORIA, Number(x.GASTO) ]);
            });

            function drawChart() {
                const container = document.querySelector('#chart_div2')

                const data2 = new google.visualization.arrayToDataTable(b);

                const options = {
                    title: 'Gasto por Categoria',
                    height: 500,
                    width: 800,
                    pieHole: 0.5
                }

                const chart2 = new google.visualization.PieChart(container)
                chart2.draw(data2, options)
            }
        
            drawChart();
        };
        
    </script>
</main>
<%- include('./parts/foot'); %>